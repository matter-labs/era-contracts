import { ethers } from "hardhat";
import { ContractFactory } from "ethers";
import type { Wallet } from "zksync-ethers";

const precompileCallerAbi = ["constructor(address addressToCall)"];

const precompileCallerBytecode =
  "0x60a060405234801561000f575f80fd5b5060405161018e38038061018e833981810160405281019061003191906100c9565b8073ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff1681525050506100f4565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6100988261006f565b9050919050565b6100a88161008e565b81146100b2575f80fd5b50565b5f815190506100c38161009f565b92915050565b5f602082840312156100de576100dd61006b565b5b5f6100eb848285016100b5565b91505092915050565b60805160856101095f395f6012015260855ff3fe6080604052348015600e575f80fd5b505f7f00000000000000000000000000000000000000000000000000000000000000009050365f80375f80365f845afa3d5f803e8015604b573d5ff35b3d5ffdfea26469706673582212204e7b8f92e398a9bdba4b38ed4bdc8c94c5aa4cebd9ee7109585eaa80270352e764736f6c634300081a0033";

export async function deployEvmPrecompileCaller(addressToCall: string, wallet: Wallet) {
  const testInterface = new ethers.utils.Interface(precompileCallerAbi);
  const factory = new ContractFactory(testInterface, precompileCallerBytecode, wallet);

  return factory.deploy(addressToCall);
}
