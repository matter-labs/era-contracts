// SPDX-License-Identifier: MIT

pragma solidity ^0.8.20;
// solhint-disable gas-custom-errors

import {StdStorage, Test, stdStorage} from "forge-std/Test.sol";
import "forge-std/console.sol";

import {IMessageRoot} from "contracts/bridgehub/IMessageRoot.sol";
import {SharedL2ContractDeployer} from "./_SharedL2ContractDeployer.sol";
import {L2_ASSET_ROUTER_ADDR, L2_ASSET_TRACKER, L2_ASSET_TRACKER_ADDR, L2_BRIDGEHUB, L2_BRIDGEHUB_ADDR, L2_MESSAGE_ROOT, L2_MESSAGE_ROOT_ADDR, L2_NATIVE_TOKEN_VAULT_ADDR, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR, L2_BASE_TOKEN_SYSTEM_CONTRACT} from "contracts/common/l2-helpers/L2ContractAddresses.sol";

abstract contract L2AssetTrackerTest is Test, SharedL2ContractDeployer {
    using stdStorage for StdStorage;

    function test_processLogsAndMessages() public {
        finalizeDepositWithChainId(271);

        vm.chainId(GATEWAY_CHAIN_ID);
        // IMessageRoot messageRoot = L2_MESSAGE_ROOT;
        // vm.prank(L2_BRIDGEHUB_ADDR);
        // messageRoot.addNewChain(271);
        bytes
            memory data = hex"000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000010f00000000000000000000000000000000000000000000000000000000000000057b6436f836b3444ff50c8f1ff00da6f3d25992fca76940090c5279848cbc1374e4ed1ec13a28c40715db6399f6f99ce04e5f19d60ad3ff6831f098cb6cf75944000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080014ff67f088fab2d6fa3cc1ccf7f175312e9cbd59f879f4cb84c2798bc70a6b62600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000008001157970c7e20d7126486cca9ccbcac08a254fc66ab477ad06e125d72fde1f3ae300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000";
        // ProcessLogsInput memory input = abi.decode(data,(ProcessLogsInput));
        // Note: get this from real local txs
        stdstore.target(address(L2_MESSAGE_ROOT_ADDR)).sig("assetTracker()").checked_write(
            address(L2_ASSET_TRACKER_ADDR)
        );
        vm.prank(L2_BRIDGEHUB.getZKChain(271));
        (bool success, ) = L2_ASSET_TRACKER_ADDR.call(bytes.concat(hex"e7ca8589", data));

        // require(success, "Failed to call L2AssetTracker");
    }
}
