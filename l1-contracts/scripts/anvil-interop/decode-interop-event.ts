#!/usr/bin/env node

import { AbiCoder } from "ethers";

const eventData = "0x4c3cc7f61703fa513fe4e742950939abf811f2ba23c2a392b602469f680e19aa6f1f46348ff3105cbfafc31ce16cc6e8b4335ef0fd613e88750f279ed6af8d6f00000000000000000000000000000000000000000000000000000000000000600100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b591608ae3ed429f1bc37703d361c427324a328ebfb398ea63b693ca5de13685e00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000520000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100030000000000000000000000000000000000000000000000000000000000010003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000003249c884fd1000000000000000000000000000000000000000000000000000000000000000a7db0c050b676a96742e525242513f3cc912f7e330b056e7534570c646fff09e6000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266000000000000000000000000e7f1725e7734ce288f8367e1bb143e90bb3f05120000000000000000000000000000000000000000000000008ac7230489e8000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c101000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000a5465737420546f6b656e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000045445535400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b00010000010a14f39fd6e51aad88f6f4ce6ab8827279cfffb922660000000000";

const abiCoder = AbiCoder.defaultAbiCoder();

try {
  // Decode event data
  // InteropBundleSent event structure:
  // event InteropBundleSent(bytes32 l2l1MsgHash, bytes32 interopBundleHash, InteropBundle interopBundle)
  const decoded = abiCoder.decode(
    [
      "bytes32", // l2l1MsgHash
      "bytes32", // interopBundleHash
      "tuple(bytes1,uint256,uint256,bytes32,tuple(bytes1,bool,address,address,uint256,bytes)[],tuple(bytes,bytes))", // InteropBundle
    ],
    eventData
  );

  console.log("\n=== InteropBundleSent Event Decoded ===\n");
  console.log("l2l1MsgHash:", decoded[0]);
  console.log("interopBundleHash:", decoded[1]);

  const bundle = decoded[2];
  console.log("\nInteropBundle:");
  console.log("  version:", bundle[0]);
  console.log("  nonce:", bundle[1].toString());
  console.log("  destinationChainId:", bundle[2].toString());
  console.log("  canonicalHash:", bundle[3]);

  const calls = bundle[4];
  console.log(`\n  calls (${calls.length}):`);

  for (let i = 0; i < calls.length; i++) {
    const call = calls[i];
    console.log(`\n  Call ${i}:`);
    console.log(`    version: ${call[0]}`);
    console.log(`    indirectCall: ${call[1]}`);
    console.log(`    address1 (index 2): ${call[2]}`);
    console.log(`    address2 (index 3): ${call[3]}`);
    console.log(`    value: ${call[4].toString()}`);
    console.log(`    data length: ${call[5].length} bytes`);
    console.log(`    data (first 100 chars): ${call[5].slice(0, 100)}`);
  }
} catch (error) {
  console.error("Failed to decode:", error);
}
